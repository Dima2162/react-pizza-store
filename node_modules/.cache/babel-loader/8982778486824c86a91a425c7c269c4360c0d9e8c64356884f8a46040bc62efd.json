{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/DimaP/Desktop/\\u041F\\u0440\\u043E\\u0435\\u043A\\u0442\\u044B/React_handmade/mypizza/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _toConsumableArray from \"C:/Users/DimaP/Desktop/\\u041F\\u0440\\u043E\\u0435\\u043A\\u0442\\u044B/React_handmade/mypizza/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _slicedToArray from \"C:/Users/DimaP/Desktop/\\u041F\\u0440\\u043E\\u0435\\u043A\\u0442\\u044B/React_handmade/mypizza/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport { __awaiter } from \"tslib\";\nimport { useMemo, useState } from 'react';\nimport useEventListener from '../useEventListener';\nimport useMemoizedFn from '../useMemoizedFn';\nimport useRequest from '../useRequest';\nimport useUpdateEffect from '../useUpdateEffect';\nimport { getTargetElement } from '../utils/domTarget';\nimport { getClientHeight, getScrollHeight, getScrollTop } from '../utils/rect';\nvar useInfiniteScroll = function useInfiniteScroll(service) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var target = options.target,\n    isNoMore = options.isNoMore,\n    _options$threshold = options.threshold,\n    threshold = _options$threshold === void 0 ? 100 : _options$threshold,\n    _options$reloadDeps = options.reloadDeps,\n    reloadDeps = _options$reloadDeps === void 0 ? [] : _options$reloadDeps,\n    manual = options.manual,\n    _onBefore = options.onBefore,\n    _onSuccess = options.onSuccess,\n    _onError = options.onError,\n    _onFinally = options.onFinally;\n  var _useState = useState(),\n    _useState2 = _slicedToArray(_useState, 2),\n    finalData = _useState2[0],\n    setFinalData = _useState2[1];\n  var _useState3 = useState(false),\n    _useState4 = _slicedToArray(_useState3, 2),\n    loadingMore = _useState4[0],\n    setLoadingMore = _useState4[1];\n  var noMore = useMemo(function () {\n    if (!isNoMore) return false;\n    return isNoMore(finalData);\n  }, [finalData]);\n  var _useRequest = useRequest(function (lastData) {\n      return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var currentData;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return service(lastData);\n            case 2:\n              currentData = _context.sent;\n              if (!lastData) {\n                setFinalData(currentData);\n              } else {\n                setFinalData(Object.assign(Object.assign({}, currentData), {\n                  // @ts-ignore\n                  list: [].concat(_toConsumableArray(lastData.list), _toConsumableArray(currentData.list))\n                }));\n              }\n              return _context.abrupt(\"return\", currentData);\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee);\n      }));\n    }, {\n      manual: manual,\n      onFinally: function onFinally(_, d, e) {\n        setLoadingMore(false);\n        _onFinally === null || _onFinally === void 0 ? void 0 : _onFinally(d, e);\n      },\n      onBefore: function onBefore() {\n        return _onBefore === null || _onBefore === void 0 ? void 0 : _onBefore();\n      },\n      onSuccess: function onSuccess(d) {\n        setTimeout(function () {\n          // eslint-disable-next-line @typescript-eslint/no-use-before-define\n          scrollMethod();\n        });\n        _onSuccess === null || _onSuccess === void 0 ? void 0 : _onSuccess(d);\n      },\n      onError: function onError(e) {\n        return _onError === null || _onError === void 0 ? void 0 : _onError(e);\n      }\n    }),\n    loading = _useRequest.loading,\n    run = _useRequest.run,\n    runAsync = _useRequest.runAsync,\n    cancel = _useRequest.cancel;\n  var loadMore = function loadMore() {\n    if (noMore) return;\n    setLoadingMore(true);\n    run(finalData);\n  };\n  var loadMoreAsync = function loadMoreAsync() {\n    if (noMore) return Promise.reject();\n    setLoadingMore(true);\n    return runAsync(finalData);\n  };\n  var reload = function reload() {\n    return run();\n  };\n  var reloadAsync = function reloadAsync() {\n    return runAsync();\n  };\n  var scrollMethod = function scrollMethod() {\n    var el = getTargetElement(target);\n    if (!el) {\n      return;\n    }\n    var scrollTop = getScrollTop(el);\n    var scrollHeight = getScrollHeight(el);\n    var clientHeight = getClientHeight(el);\n    if (scrollHeight - scrollTop <= clientHeight + threshold) {\n      loadMore();\n    }\n  };\n  useEventListener('scroll', function () {\n    if (loading || loadingMore) {\n      return;\n    }\n    scrollMethod();\n  }, {\n    target: target\n  });\n  useUpdateEffect(function () {\n    run();\n  }, _toConsumableArray(reloadDeps));\n  return {\n    data: finalData,\n    loading: !loadingMore && loading,\n    loadingMore: loadingMore,\n    noMore: noMore,\n    loadMore: useMemoizedFn(loadMore),\n    loadMoreAsync: useMemoizedFn(loadMoreAsync),\n    reload: useMemoizedFn(reload),\n    reloadAsync: useMemoizedFn(reloadAsync),\n    mutate: setFinalData,\n    cancel: cancel\n  };\n};\nexport default useInfiniteScroll;","map":{"version":3,"names":["__awaiter","useMemo","useState","useEventListener","useMemoizedFn","useRequest","useUpdateEffect","getTargetElement","getClientHeight","getScrollHeight","getScrollTop","useInfiniteScroll","service","options","target","isNoMore","threshold","reloadDeps","manual","onBefore","onSuccess","onError","onFinally","finalData","setFinalData","loadingMore","setLoadingMore","noMore","lastData","currentData","Object","assign","list","_","d","e","setTimeout","scrollMethod","loading","run","runAsync","cancel","loadMore","loadMoreAsync","Promise","reject","reload","reloadAsync","el","scrollTop","scrollHeight","clientHeight","data","mutate"],"sources":["C:/Users/DimaP/Desktop/Проекты/React_handmade/mypizza/node_modules/ahooks/es/useInfiniteScroll/index.js"],"sourcesContent":["import { __awaiter } from \"tslib\";\nimport { useMemo, useState } from 'react';\nimport useEventListener from '../useEventListener';\nimport useMemoizedFn from '../useMemoizedFn';\nimport useRequest from '../useRequest';\nimport useUpdateEffect from '../useUpdateEffect';\nimport { getTargetElement } from '../utils/domTarget';\nimport { getClientHeight, getScrollHeight, getScrollTop } from '../utils/rect';\nconst useInfiniteScroll = (service, options = {}) => {\n  const {\n    target,\n    isNoMore,\n    threshold = 100,\n    reloadDeps = [],\n    manual,\n    onBefore,\n    onSuccess,\n    onError,\n    onFinally\n  } = options;\n  const [finalData, setFinalData] = useState();\n  const [loadingMore, setLoadingMore] = useState(false);\n  const noMore = useMemo(() => {\n    if (!isNoMore) return false;\n    return isNoMore(finalData);\n  }, [finalData]);\n  const {\n    loading,\n    run,\n    runAsync,\n    cancel\n  } = useRequest(lastData => __awaiter(void 0, void 0, void 0, function* () {\n    const currentData = yield service(lastData);\n    if (!lastData) {\n      setFinalData(currentData);\n    } else {\n      setFinalData(Object.assign(Object.assign({}, currentData), {\n        // @ts-ignore\n        list: [...lastData.list, ...currentData.list]\n      }));\n    }\n    return currentData;\n  }), {\n    manual,\n    onFinally: (_, d, e) => {\n      setLoadingMore(false);\n      onFinally === null || onFinally === void 0 ? void 0 : onFinally(d, e);\n    },\n    onBefore: () => onBefore === null || onBefore === void 0 ? void 0 : onBefore(),\n    onSuccess: d => {\n      setTimeout(() => {\n        // eslint-disable-next-line @typescript-eslint/no-use-before-define\n        scrollMethod();\n      });\n      onSuccess === null || onSuccess === void 0 ? void 0 : onSuccess(d);\n    },\n    onError: e => onError === null || onError === void 0 ? void 0 : onError(e)\n  });\n  const loadMore = () => {\n    if (noMore) return;\n    setLoadingMore(true);\n    run(finalData);\n  };\n  const loadMoreAsync = () => {\n    if (noMore) return Promise.reject();\n    setLoadingMore(true);\n    return runAsync(finalData);\n  };\n  const reload = () => run();\n  const reloadAsync = () => runAsync();\n  const scrollMethod = () => {\n    const el = getTargetElement(target);\n    if (!el) {\n      return;\n    }\n    const scrollTop = getScrollTop(el);\n    const scrollHeight = getScrollHeight(el);\n    const clientHeight = getClientHeight(el);\n    if (scrollHeight - scrollTop <= clientHeight + threshold) {\n      loadMore();\n    }\n  };\n  useEventListener('scroll', () => {\n    if (loading || loadingMore) {\n      return;\n    }\n    scrollMethod();\n  }, {\n    target\n  });\n  useUpdateEffect(() => {\n    run();\n  }, [...reloadDeps]);\n  return {\n    data: finalData,\n    loading: !loadingMore && loading,\n    loadingMore,\n    noMore,\n    loadMore: useMemoizedFn(loadMore),\n    loadMoreAsync: useMemoizedFn(loadMoreAsync),\n    reload: useMemoizedFn(reload),\n    reloadAsync: useMemoizedFn(reloadAsync),\n    mutate: setFinalData,\n    cancel\n  };\n};\nexport default useInfiniteScroll;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}